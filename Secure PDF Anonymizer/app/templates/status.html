{% extends "base.html" %}
{% block title %}Durum KontrolÃ¼ - GÃ¼venli Belge AnonimleÅŸtirici{% endblock %}
{% block content %}
<div class="container my-5">
  <h2 class="mb-4 text-center">ğŸ“„ Belge Durumunu Kontrol Et</h2>
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <form method="POST" id="statusForm" class="needs-validation" novalidate>
        <div class="mb-3">
          <label for="tracking_number" class="form-label">Takip NumarasÄ±</label>
          <input type="text" class="form-control" id="tracking_number" name="tracking_number" placeholder="Ã–rn: 1907" required>
          <div class="invalid-feedback">LÃ¼tfen takip numarasÄ±nÄ± girin.</div>
        </div>
        <div class="mb-3">
          <label for="email" class="form-label">E-posta Adresiniz</label>
          <input type="email" class="form-control" id="email" name="email" placeholder="alperenÃ¶zgÃ¼r@gmail.com" required>
          <div class="invalid-feedback">LÃ¼tfen geÃ§erli bir e-posta girin.</div>
        </div>
        <button type="submit" class="btn btn-primary w-100">
          <i class="bi bi-search"></i> Durumu Kontrol Et
        </button>
      </form>
    </div>
  </div>
  {% if article %}
  <hr>
  <h4 class="mt-4">ğŸ” Belge DetaylarÄ±</h4>
  <div class="card shadow-sm">
    <div class="card-header">
      <strong>Takip NumarasÄ±:</strong> {{ article.tracking_number }}
    </div>
    <div class="card-body">
      <p>
        <strong>Durum:</strong>
        {% if article.status == "uploaded" %}
          <span class="badge bg-primary">ğŸ“¤ YÃ¼klenmiÅŸ</span>
        {% elif article.status == "anonymized" %}
          <span class="badge bg-success">ğŸ•µï¸â€â™€ï¸ AnonimleÅŸtirilmiÅŸ</span>
        {% elif article.status == "reviewed" %}
          <span class="badge bg-info">ğŸ” Ä°ncelenmiÅŸ</span>
        {% elif article.status == "revision_requested" %}
          <span class="badge bg-warning text-dark">ğŸ”„ Revizyon Ä°stendi</span>
        {% elif article.status == "revision_required" %}
          <span class="badge bg-danger">âš ï¸ Revizyon Gerekiyor</span>
        {% elif article.status == "revised" %}
          <span class="badge bg-secondary">âœ… Revize EdilmiÅŸ</span>
        {% else %}
          <span class="badge bg-secondary">{{ article.status }}</span>
        {% endif %}
      </p>

      {% if article.revision_instructions %}
      <p>
        <strong>Revizyon TalimatlarÄ±:</strong> {{ article.revision_instructions }}
      </p>
      {% endif %}

      {% if article.anonymized_filepath %}
      <p>
        <a href="{{ url_for('main.download', tracking_number=article.tracking_number) }}" class="btn btn-info">
          <i class="bi bi-download"></i> AnonimleÅŸtirilmiÅŸ PDF Ä°ndir
        </a>
      </p>
      {% endif %}

      {% if article.status == "revision_required" or article.status == "revision_requested" %}
      <hr>
      <p class="text-danger fw-bold">
        ğŸš¨ Makaleniz iÃ§in revizyon isteniyor. LÃ¼tfen talimatlara gÃ¶re revize edilmiÅŸ PDFâ€™i yÃ¼kleyin.
      </p>
      <p>
        <a href="{{ url_for('main.revision', tracking_number=article.tracking_number) }}" class="btn btn-warning">
          <i class="bi bi-upload"></i> Revize EdilmiÅŸ PDF YÃ¼kle
        </a>
      </p>
      {% endif %}
    </div>
  </div>
  {% elif not_found %}
  <div class="alert alert-warning mt-3">
    âš ï¸ Belge bulunamadÄ±. LÃ¼tfen takip numarasÄ±nÄ± ve e-postanÄ±zÄ± kontrol edin.
  </div>
  {% endif %}
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
  (function () {
    'use strict';
    var forms = document.querySelectorAll('.needs-validation');
    Array.prototype.slice.call(forms).forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  })();
</script>
{% endblock %}
